{
  "default": {
    "cguid": "1",
    "type": "ProtoStubs",
    "version": "0.1",
    "description": "Description of MatrixProtoStub",
    "objectName": "MatrixProtoStub",
    "sourcePackageURL": "/sourcePackage",
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpIHsKICBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICJvYmplY3QiICYmIHR5cGVvZiBtb2R1bGUgIT09ICJ1bmRlZmluZWQiKSB7CiAgICBtb2R1bGUuZXhwb3J0cyA9IGYoKQogIH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gImZ1bmN0aW9uIiAmJiBkZWZpbmUuYW1kKSB7CiAgICBkZWZpbmUoW10sIGYpCiAgfSBlbHNlIHsKICAgIHZhciBnOwogICAgaWYgKHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiKSB7CiAgICAgIGcgPSB3aW5kb3cKICAgIH0gZWxzZSBpZiAodHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgZyA9IGdsb2JhbAogICAgfSBlbHNlIGlmICh0eXBlb2Ygc2VsZiAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgZyA9IHNlbGYKICAgIH0gZWxzZSB7CiAgICAgIGcgPSB0aGlzCiAgICB9CiAgICBnLmFjdGl2YXRlID0gZigpCiAgfQp9KShmdW5jdGlvbigpIHsKICB2YXIgZGVmaW5lLCBtb2R1bGUsIGV4cG9ydHM7CiAgcmV0dXJuIChmdW5jdGlvbiBlKHQsIG4sIHIpIHsKICAgIGZ1bmN0aW9uIHMobywgdSkgewogICAgICBpZiAoIW5bb10pIHsKICAgICAgICBpZiAoIXRbb10pIHsKICAgICAgICAgIHZhciBhID0gdHlwZW9mIHJlcXVpcmUgPT0gImZ1bmN0aW9uIiAmJiByZXF1aXJlOwogICAgICAgICAgaWYgKCF1ICYmIGEpIHJldHVybiBhKG8sICEwKTsKICAgICAgICAgIGlmIChpKSByZXR1cm4gaShvLCAhMCk7CiAgICAgICAgICB2YXIgZiA9IG5ldyBFcnJvcigiQ2Fubm90IGZpbmQgbW9kdWxlICciICsgbyArICInIik7CiAgICAgICAgICB0aHJvdyBmLmNvZGUgPSAiTU9EVUxFX05PVF9GT1VORCIsIGYKICAgICAgICB9CiAgICAgICAgdmFyIGwgPSBuW29dID0gewogICAgICAgICAgZXhwb3J0czoge30KICAgICAgICB9OwogICAgICAgIHRbb11bMF0uY2FsbChsLmV4cG9ydHMsIGZ1bmN0aW9uKGUpIHsKICAgICAgICAgIHZhciBuID0gdFtvXVsxXVtlXTsKICAgICAgICAgIHJldHVybiBzKG4gPyBuIDogZSkKICAgICAgICB9LCBsLCBsLmV4cG9ydHMsIGUsIHQsIG4sIHIpCiAgICAgIH0KICAgICAgcmV0dXJuIG5bb10uZXhwb3J0cwogICAgfQogICAgdmFyIGkgPSB0eXBlb2YgcmVxdWlyZSA9PSAiZnVuY3Rpb24iICYmIHJlcXVpcmU7CiAgICBmb3IgKHZhciBvID0gMDsgbyA8IHIubGVuZ3RoOyBvKyspIHMocltvXSk7CiAgICByZXR1cm4gcwogIH0pKHsKICAgIDE6IFtmdW5jdGlvbihyZXF1aXJlLCBtb2R1bGUsIGV4cG9ydHMpIHsKICAgICAgKGZ1bmN0aW9uKGdsb2JhbCkgewogICAgICAgICJ1c2Ugc3RyaWN0IjsKCiAgICAgICAgKGZ1bmN0aW9uKGYpIHsKICAgICAgICAgIGlmICh0eXBlb2YgZXhwb3J0cyA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIG1vZHVsZSAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBmKCk7CiAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICJmdW5jdGlvbiIgJiYgZGVmaW5lLmFtZCkgewogICAgICAgICAgICBkZWZpbmUoW10sIGYpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdmFyIGc7CiAgICAgICAgICAgIGlmICh0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIGcgPSB3aW5kb3c7CiAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGdsb2JhbCAhPT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgICBnID0gZ2xvYmFsOwogICAgICAgICAgICB9IGVsc2UgaWYgKHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIikgewogICAgICAgICAgICAgIGcgPSBzZWxmOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIGcgPSB0aGlzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGcuTWF0cml4UHJvdG9TdHViID0gZigpOwogICAgICAgICAgfQogICAgICAgIH0pKGZ1bmN0aW9uKCkgewogICAgICAgICAgdmFyIGRlZmluZSwgbW9kdWxlLCBleHBvcnRzOwogICAgICAgICAgcmV0dXJuIChmdW5jdGlvbiBlKHQsIG4sIHIpIHsKICAgICAgICAgICAgZnVuY3Rpb24gcyhvLCB1KSB7CiAgICAgICAgICAgICAgaWYgKCFuW29dKSB7CiAgICAgICAgICAgICAgICBpZiAoIXRbb10pIHsKICAgICAgICAgICAgICAgICAgdmFyIGEgPSB0eXBlb2YgcmVxdWlyZSA9PSAiZnVuY3Rpb24iICYmIHJlcXVpcmU7CiAgICAgICAgICAgICAgICAgIGlmICghdSAmJiBhKSByZXR1cm4gYShvLCAhMCk7CiAgICAgICAgICAgICAgICAgIGlmIChpKSByZXR1cm4gaShvLCAhMCk7CiAgICAgICAgICAgICAgICAgIHZhciBmID0gbmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIgKyBvICsgIiciKTsKICAgICAgICAgICAgICAgICAgdGhyb3cgKGYuY29kZSA9ICJNT0RVTEVfTk9UX0ZPVU5EIiwgZik7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB2YXIgbCA9IG5bb10gPSB7CiAgICAgICAgICAgICAgICAgIGV4cG9ydHM6IHt9CiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgdFtvXVswXS5jYWxsKGwuZXhwb3J0cywgZnVuY3Rpb24oZSkgewogICAgICAgICAgICAgICAgICB2YXIgbiA9IHRbb11bMV1bZV07CiAgICAgICAgICAgICAgICAgIHJldHVybiBzKG4gPyBuIDogZSk7CiAgICAgICAgICAgICAgICB9LCBsLCBsLmV4cG9ydHMsIGUsIHQsIG4sIHIpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICByZXR1cm4gbltvXS5leHBvcnRzOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHZhciBpID0gdHlwZW9mIHJlcXVpcmUgPT0gImZ1bmN0aW9uIiAmJiByZXF1aXJlOwogICAgICAgICAgICBmb3IgKHZhciBvID0gMDsgbyA8IHIubGVuZ3RoOyBvKyspIHMocltvXSk7CiAgICAgICAgICAgIHJldHVybiBzOwogICAgICAgICAgfSkoewogICAgICAgICAgICAxOiBbZnVuY3Rpb24ocmVxdWlyZSwgbW9kdWxlLCBleHBvcnRzKSB7CgogICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAqIFByb3RvU3R1YiBJbnRlcmZhY2UKICAgICAgICAgICAgICAgKi8KICAgICAgICAgICAgICAidXNlIHN0cmljdCI7CgogICAgICAgICAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICAgICAgICAgICAgICAgIHZhbHVlOiB0cnVlCiAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgIHZhciBfY3JlYXRlQ2xhc3MgPSAoZnVuY3Rpb24oKSB7CiAgICAgICAgICAgICAgICBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKHRhcmdldCwgcHJvcHMpIHsKICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwcm9wcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRvci5lbnVtZXJhYmxlID0gZGVzY3JpcHRvci5lbnVtZXJhYmxlIHx8IGZhbHNlOwogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0b3IuY29uZmlndXJhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgICAgICAgICAgICAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbihDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsKICAgICAgICAgICAgICAgICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgICAgICAgICAgICAgICAgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7CiAgICAgICAgICAgICAgICAgIHJldHVybiBDb25zdHJ1Y3RvcjsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgICAgZXhwb3J0c1siZGVmYXVsdCJdID0gYWN0aXZhdGU7CgogICAgICAgICAgICAgIGZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICAgICAgICAgICAgICAgIGlmICghKGluc3RhbmNlIGluc3RhbmNlb2YgQ29uc3RydWN0b3IpKSB7CiAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvbiIpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgdmFyIE1hdHJpeFByb3RvU3R1YiA9IChmdW5jdGlvbigpIHsKCiAgICAgICAgICAgICAgICAvKioKICAgICAgICAgICAgICAgICAqIEluaXRpYWxpc2UgdGhlIHByb3RvY29sIHN0dWIgaW5jbHVkaW5nIGFzIGlucHV0IHBhcmFtZXRlcnMgaXRzIGFsbG9jYXRlZAogICAgICAgICAgICAgICAgICogY29tcG9uZW50IHJ1bnRpbWUgdXJsLCB0aGUgcnVudGltZSBCVVMgcG9zdE1lc3NhZ2UgZnVuY3Rpb24gdG8gYmUgaW52b2tlZAogICAgICAgICAgICAgICAgICogb24gbWVzc2FnZXMgcmVjZWl2ZWQgYnkgdGhlIHByb3RvY29sIHN0dWIgYW5kIHJlcXVpcmVkIGNvbmZpZ3VyYXRpb24gcmV0cmlldmVkIGZyb20gcHJvdG9jb2xTdHViIGRlc2NyaXB0b3IuCiAgICAgICAgICAgICAgICAgKiBAcGFyYW0gIHtVUkwucnVudGltZVByb3RvU3R1YlVSTH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVudGltZVByb3RvU3R1YlVSTCBydW50aW1lUHJvdG9TdWJVUkwKICAgICAgICAgICAgICAgICAqIEBwYXJhbSAge01lc3NhZ2UuTWVzc2FnZX0gICAgICAgICAgICAgICAgICAgICAgICAgICBidXNQb3N0TWVzc2FnZSAgICAgY29uZmlndXJhdGlvbgogICAgICAgICAgICAgICAgICogQHBhcmFtICB7UHJvdG9TdHViRGVzY3JpcHRvci5Db25maWd1cmF0aW9uRGF0YUxpc3R9IGNvbmZpZ3VyYXRpb24gICAgICBjb25maWd1cmF0aW9uCiAgICAgICAgICAgICAgICAgKi8KCiAgICAgICAgICAgICAgICBmdW5jdGlvbiBNYXRyaXhQcm90b1N0dWIocnVudGltZVByb3RvU3R1YlVSTCwgbWluaUJ1cywgY29uZmlndXJhdGlvbikgewogICAgICAgICAgICAgICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgICAgICAgICAgICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1hdHJpeFByb3RvU3R1Yik7CgogICAgICAgICAgICAgICAgICB0aGlzLl9ydW50aW1lUHJvdG9TdHViVVJMID0gcnVudGltZVByb3RvU3R1YlVSTDsKICAgICAgICAgICAgICAgICAgdGhpcy5fcnVudGltZVVSTCA9IGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTDsKICAgICAgICAgICAgICAgICAgdGhpcy5fY29uZmlndXJhdGlvbiA9IGNvbmZpZ3VyYXRpb247CiAgICAgICAgICAgICAgICAgIHRoaXMuX2J1cyA9IG1pbmlCdXM7CiAgICAgICAgICAgICAgICAgIHRoaXMuX2lkZW50aXR5ID0gbnVsbDsKICAgICAgICAgICAgICAgICAgdGhpcy5fd3MgPSBudWxsOwogICAgICAgICAgICAgICAgICB0aGlzLl9idXMuYWRkTGlzdGVuZXIoJyonLCBmdW5jdGlvbihtc2cpIHsKICAgICAgICAgICAgICAgICAgICBfdGhpcy5fYXNzdW1lT3BlbiA9IHRydWU7CiAgICAgICAgICAgICAgICAgICAgX3RoaXMuX3NlbmRXU01zZyhtc2cpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgdGhpcy5fYXNzdW1lT3BlbiA9IGZhbHNlOwogICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICogQ29ubmVjdCB0aGUgcHJvdG9jb2wgc3R1YiB0byB0aGUgYmFjay1lbmQgc2VydmVyLgogICAgICAgICAgICAgICAgICogQHBhcmFtICB7SURUb2tlbn0gaWRlbnRpdHkgaWRlbnRpdHkgLi4gdGhpcyBjYW4gYmUgZWl0aGVyIGFuIGlkdG9rZW4sCiAgICAgICAgICAgICAgICAgKiAgICAgICAgIG9yIGEgdXNlcm5hbWUvcGFzc3dvcmQgY29tYmluYXRpb24gdG8gYXV0aGVudGljYXRlIGFnYWluc3QgdGhlIE1hdHJpeCBIUwogICAgICAgICAgICAgICAgICovCgogICAgICAgICAgICAgICAgX2NyZWF0ZUNsYXNzKE1hdHJpeFByb3RvU3R1YiwgW3sKICAgICAgICAgICAgICAgICAga2V5OiAiY29ubmVjdCIsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBjb25uZWN0KGlkZW50aXR5KSB7CiAgICAgICAgICAgICAgICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2lkZW50aXR5ID0gaWRlbnRpdHk7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fYXNzdW1lT3BlbiA9IHRydWU7CgogICAgICAgICAgICAgICAgICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgICAgICAgICAgICAgICBpZiAoX3RoaXMyLl93cyAmJiBfdGhpczIuX3dzLnJlYWR5U3RhdGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZShfdGhpczIuX3dzKTsKICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgICAgIC8vIGNyZWF0ZSBzb2NrZXQgdG8gdGhlIE1OCiAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX3dzID0gbmV3IFdlYlNvY2tldChfdGhpczIuX2NvbmZpZ3VyYXRpb24ubWVzc2FnaW5nbm9kZSk7CiAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX3dzLm9ub3BlbiA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX29uV1NPcGVuKCk7CiAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgIC8vIG1lc3NhZ2UgaGFuZGxlciBmb3IgaW5pdGlhbCBoYW5kc2hha2Ugb25seQogICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl93cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihtc2cpIHsKCiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtID0gSlNPTi5wYXJzZShtc2cuZGF0YSk7CiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChtLnJlc3BvbnNlID09PSAyMDApIHsKICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBpbnN0YWxsIGRlZmF1bHQgbXNnIGhhbmRsZXIsIHNlbmQgc3RhdHVzIGFuZCByZXNvbHZlCiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl93cy5vbm1lc3NhZ2UgPSBmdW5jdGlvbihtKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX29uV1NNZXNzYWdlKG0pOwogICAgICAgICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMyLl9zZW5kU3RhdHVzKCJjb25uZWN0ZWQiKTsKICAgICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF90aGlzMi5fd3MpOwogICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdCgpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgICB9OwoKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5fd3Mub25jbG9zZSA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX29uV1NDbG9zZSgpOwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICAgIF90aGlzMi5fd3Mub25lcnJvciA9IGZ1bmN0aW9uKCkgewogICAgICAgICAgICAgICAgICAgICAgICBfdGhpczIuX29uV1NFcnJvcigpOwogICAgICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAgICAgICAqIFRvIGRpc2Nvbm5lY3QgdGhlIHByb3RvY29sIHN0dWIuCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBrZXk6ICJkaXNjb25uZWN0IiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2Nvbm5lY3QoKSB7CiAgICAgICAgICAgICAgICAgICAgLy8gc2VuZCBkaXNjb25uZWN0IGNvbW1hbmQgdG8gTU4gdG8gaW5kaWNhdGUgdGhhdCByZXNvdXJjZXMgZm9yIHRoaXMgcnVudGltZVVSTCBjYW4gYmUgY2xlYW5lZCB1cAogICAgICAgICAgICAgICAgICAgIC8vIHRoZSBjbG9zZSBvZiB0aGUgd2Vic29ja2V0IHdpbGwgYmUgaW5pdGlhdGVkIGZyb20gc2VydmVyIHNpZGUKICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZW5kV1NNc2coewogICAgICAgICAgICAgICAgICAgICAgY21kOiAiZGlzY29ubmVjdCIsCiAgICAgICAgICAgICAgICAgICAgICBkYXRhOiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJ1bnRpbWVVUkw6IHRoaXMuX3J1bnRpbWVVUkwKICAgICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgICB0aGlzLl9hc3N1bWVPcGVuID0gZmFsc2U7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgKiBGaWx0ZXIgbWV0aG9kIHRoYXQgc2hvdWxkIGJlIHVzZWQgZm9yIGV2ZXJ5IG1lc3NhZ2VzIGluIGRpcmVjdGlvbjogUHJvdG9zdHViIC0+IE1lc3NhZ2VOb2RlCiAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSAge01lc3NhZ2V9IG1zZyBPcmlnaW5hbCBtZXNzYWdlIGZyb20gdGhlIE1lc3NhZ2VCdXMKICAgICAgICAgICAgICAgICAgICogQHJldHVybiB7Ym9vbGVhbn0gdHJ1ZSBpZiBpdCdzIHRvIGJlIGRlbGl2ZXIgaW4gdGhlIE1lc3NhZ2VOb2RlCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBrZXk6ICJfZmlsdGVyIiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9maWx0ZXIobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgKG1zZy5ib2R5ICYmIG1zZy5ib2R5LnZpYSA9PT0gdGhpcy5fcnVudGltZVByb3RvU3R1YlVSTCkgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIl9zZW5kV1NNc2ciLAogICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX3NlbmRXU01zZyhtc2cpIHsKICAgICAgICAgICAgICAgICAgICB2YXIgX3RoaXMzID0gdGhpczsKCiAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMuX2ZpbHRlcihtc2cpKSB7CiAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fYXNzdW1lT3BlbikgdGhpcy5jb25uZWN0KCkudGhlbihmdW5jdGlvbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMzLl93cy5zZW5kKEpTT04uc3RyaW5naWZ5KG1zZykpOwogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIl9zZW5kU3RhdHVzIiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9zZW5kU3RhdHVzKHZhbHVlLCByZWFzb24pIHsKICAgICAgICAgICAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICAgICAgICAgICAgdHlwZTogJ3VwZGF0ZScsCiAgICAgICAgICAgICAgICAgICAgICBmcm9tOiB0aGlzLl9ydW50aW1lUHJvdG9TdHViVVJMLAogICAgICAgICAgICAgICAgICAgICAgdG86IHRoaXMuX3J1bnRpbWVQcm90b1N0dWJVUkwgKyAnL3N0YXR1cycsCiAgICAgICAgICAgICAgICAgICAgICBib2R5OiB7CiAgICAgICAgICAgICAgICAgICAgICAgIHZhbHVlOiB2YWx1ZQogICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICAgICAgaWYgKHJlYXNvbikgewogICAgICAgICAgICAgICAgICAgICAgbXNnLmJvZHkuZGVzYyA9IHJlYXNvbjsKICAgICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShtc2cpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIl9vbldTT3BlbiIsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfb25XU09wZW4oKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VuZFdTTXNnKHsKICAgICAgICAgICAgICAgICAgICAgIGNtZDogImNvbm5lY3QiLAogICAgICAgICAgICAgICAgICAgICAgZGF0YTogewogICAgICAgICAgICAgICAgICAgICAgICBydW50aW1lVVJMOiB0aGlzLl9ydW50aW1lVVJMCiAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAgIC8qKgogICAgICAgICAgICAgICAgICAgKiBNZXRob2QgdGhhdCBzaG91bGQgYmUgdXNlZCB0byBkZWxpdmVyIHRoZSBtZXNzYWdlIGluIGRpcmVjdGlvbjogUHJvdG9zdHViIC0+IE1lc3NhZ2VCdXMgKGNvcmUpCiAgICAgICAgICAgICAgICAgICAqIEBwYXJhbSAge01lc3NhZ2V9IG1zZyBPcmlnaW5hbCBtZXNzYWdlIGZyb20gdGhlIE1lc3NhZ2VOb2RlCiAgICAgICAgICAgICAgICAgICAqLwogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBrZXk6ICJfZGVsaXZlciIsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfZGVsaXZlcihtc2cpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoIW1zZy5ib2R5KSBtc2cuYm9keSA9IHt9OwoKICAgICAgICAgICAgICAgICAgICBtc2cuYm9keS52aWEgPSB0aGlzLl9ydW50aW1lUHJvdG9TdHViVVJMOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX2J1cy5wb3N0TWVzc2FnZShtc2cpOwogICAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgICAvLyBwYXJzZSBtc2cgYW5kIGZvcndhcmQgaXQgbG9jYWxseSB0byBtaW5pQnVzCiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIl9vbldTTWVzc2FnZSIsCiAgICAgICAgICAgICAgICAgIHZhbHVlOiBmdW5jdGlvbiBfb25XU01lc3NhZ2UobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGVsaXZlcihKU09OLnBhcnNlKG1zZy5kYXRhKSk7CiAgICAgICAgICAgICAgICAgICAgLy8gdGhpcy5fYnVzLnBvc3RNZXNzYWdlKEpTT04ucGFyc2UobXNnLmRhdGEpKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSwgewogICAgICAgICAgICAgICAgICBrZXk6ICJfb25XU0Nsb3NlIiwKICAgICAgICAgICAgICAgICAgdmFsdWU6IGZ1bmN0aW9uIF9vbldTQ2xvc2UoKSB7CiAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygid2Vic29ja2V0IGNsb3NlZCIpOwogICAgICAgICAgICAgICAgICAgIHRoaXMuX3NlbmRTdGF0dXMoImRpc2Nvbm5lY3RlZCIpOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCB7CiAgICAgICAgICAgICAgICAgIGtleTogIl9vbldTRXJyb3IiLAogICAgICAgICAgICAgICAgICB2YWx1ZTogZnVuY3Rpb24gX29uV1NFcnJvcihlcnIpIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygid2Vic29ja2V0IGVycm9yOiAiICsgZXJyKTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfV0pOwoKICAgICAgICAgICAgICAgIHJldHVybiBNYXRyaXhQcm90b1N0dWI7CiAgICAgICAgICAgICAgfSkoKTsKCiAgICAgICAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUodXJsLCBidXMsIGNvbmZpZykgewogICAgICAgICAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgICAgICAgbmFtZTogJ01hdHJpeFByb3RvU3R1YicsCiAgICAgICAgICAgICAgICAgIGluc3RhbmNlOiBuZXcgTWF0cml4UHJvdG9TdHViKHVybCwgYnVzLCBjb25maWcpCiAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07CiAgICAgICAgICAgIH0sIHt9XQogICAgICAgICAgfSwge30sIFsxXSkoMSk7CiAgICAgICAgfSk7CgogICAgICB9KS5jYWxsKHRoaXMsIHR5cGVvZiBnbG9iYWwgIT09ICJ1bmRlZmluZWQiID8gZ2xvYmFsIDogdHlwZW9mIHNlbGYgIT09ICJ1bmRlZmluZWQiID8gc2VsZiA6IHR5cGVvZiB3aW5kb3cgIT09ICJ1bmRlZmluZWQiID8gd2luZG93IDoge30pCiAgICB9LCB7fV0KICB9LCB7fSwgWzFdKSgxKQp9KTsK",
      "sourceCodeClassname": "MatrixProtoStub",
      "encoding": "base64",
      "signature": ""
    },
    "language": "Javascript ECMA5",
    "signature": "",
    "messageSchemas": "",
    "constraints": "",
    "hypertyCapabilities": "",
    "protocolCapabilities": "",
    "policies": "",
    "dataObjects": [],
    "configuration": {
      "homeserver": "matrix2.rethink.com",
      "messagingnode": "ws://matrix2.rethink.com:8001/stub/connect"
    }
  },
  "google.com": {
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcuYWN0aXZhdGUgPSBmKCl9fSkoZnVuY3Rpb24oKXt2YXIgZGVmaW5lLG1vZHVsZSxleHBvcnRzO3JldHVybiAoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoIkNhbm5vdCBmaW5kIG1vZHVsZSAnIitvKyInIik7dGhyb3cgZi5jb2RlPSJNT0RVTEVfTk9UX0ZPVU5EIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PSJmdW5jdGlvbiImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pKHsxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9jcmVhdGVDbGFzcyA9IChmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoJ3ZhbHVlJyBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwgZGVzY3JpcHRvci5rZXksIGRlc2NyaXB0b3IpOyB9IH0gcmV0dXJuIGZ1bmN0aW9uIChDb25zdHJ1Y3RvciwgcHJvdG9Qcm9wcywgc3RhdGljUHJvcHMpIHsgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsgaWYgKHN0YXRpY1Byb3BzKSBkZWZpbmVQcm9wZXJ0aWVzKENvbnN0cnVjdG9yLCBzdGF0aWNQcm9wcyk7IHJldHVybiBDb25zdHJ1Y3RvcjsgfTsgfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IGFjdGl2YXRlOwoKZnVuY3Rpb24gX2NsYXNzQ2FsbENoZWNrKGluc3RhbmNlLCBDb25zdHJ1Y3RvcikgeyBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgeyB0aHJvdyBuZXcgVHlwZUVycm9yKCdDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24nKTsgfSB9Cgp2YXIgaWRlbnRpdGllcyA9IHt9Owp2YXIgbklkZW50aXR5ID0gMDsKCnZhciBnb29nbGVJbmZvID0gewogIGNsaWVudFNlY3JldDogJ1h4NHJLdWNiNVpZVGFYbGNaWDlITGZaVycsCiAgY2xpZW50SUQ6ICc4MDgzMjk1NjYwMTItdHFyOHFvaDExMTk0MmdkMmtnMDA3dDBzOGYyNzdyb2kuYXBwcy5nb29nbGV1c2VyY29udGVudC5jb20nLAogIHJlZGlyZWN0VVJJOiBsb2NhdGlvbi5vcmlnaW4sCiAgaXNzdWVyOiAnaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tJywKICB0b2tlbkVuZHBvaW50OiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3Y0L3Rva2VuPycsCiAgandrc1VyaTogJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92My9jZXJ0cz8nLAogIGF1dGhvcmlzYXRpb25FbmRwb2ludDogJ2h0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoPycsCiAgdXNlcmluZm86ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9vYXV0aDIvdjMvdXNlcmluZm8/YWNjZXNzX3Rva2VuPScsCiAgdG9rZW5JbmZvOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vb2F1dGgyL3YzL3Rva2VuaW5mbz9pZF90b2tlbj0nLAogIGFjY2Vzc1R5cGU6ICdvZmZsaW5lJywKICB0eXBlOiAnY29kZSB0b2tlbiBpZF90b2tlbicsCiAgc2NvcGU6ICdvcGVuaWQlMjBlbWFpbCUyMHByb2ZpbGUnLAogIHN0YXRlOiAnc3RhdGUnCn07CgovL2Z1bmN0aW9uIHRvIHBhcnNlIHRoZSBxdWVyeSBzdHJpbmcgaW4gdGhlIGdpdmVuIFVSTCB0byBvYmF0aW4gY2VydGFpbiB2YWx1ZXMKZnVuY3Rpb24gdXJsUGFyc2VyKHVybCwgbmFtZSkgewogIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcW10vLCAnXFxcWycpLnJlcGxhY2UoL1tcXV0vLCAnXFxcXScpOwogIHZhciByZWdleFMgPSAnW1xcIyY/XScgKyBuYW1lICsgJz0oW14mI10qKSc7CiAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cChyZWdleFMpOwogIHZhciByZXN1bHRzID0gcmVnZXguZXhlYyh1cmwpOwogIGlmIChyZXN1bHRzID09PSBudWxsKSByZXR1cm4gJyc7ZWxzZSByZXR1cm4gcmVzdWx0c1sxXTsKfQoKZnVuY3Rpb24gc2VuZEhUVFBSZXF1ZXN0KG1ldGhvZCwgdXJsKSB7CiAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogIGlmICgnd2l0aENyZWRlbnRpYWxzJyBpbiB4aHIpIHsKICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsLCB0cnVlKTsKICB9IGVsc2UgaWYgKHR5cGVvZiBYRG9tYWluUmVxdWVzdCAhPSAndW5kZWZpbmVkJykgewogICAgLy8gT3RoZXJ3aXNlLCBjaGVjayBpZiBYRG9tYWluUmVxdWVzdC4KICAgIC8vIFhEb21haW5SZXF1ZXN0IG9ubHkgZXhpc3RzIGluIElFLCBhbmQgaXMgSUUncyB3YXkgb2YgbWFraW5nIENPUlMgcmVxdWVzdHMuCiAgICB4aHIgPSBuZXcgWERvbWFpblJlcXVlc3QoKTsKICAgIHhoci5vcGVuKG1ldGhvZCwgdXJsKTsKICB9IGVsc2UgewogICAgLy8gT3RoZXJ3aXNlLCBDT1JTIGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhlIGJyb3dzZXIuCiAgICB4aHIgPSBudWxsOwogIH0KICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgaWYgKHhocikgewogICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgICAgdmFyIGluZm8gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpOwogICAgICAgICAgICByZXNvbHZlKGluZm8pOwogICAgICAgICAgfSBlbHNlIGlmICh4aHIuc3RhdHVzID09PSA0MDApIHsKICAgICAgICAgICAgcmVqZWN0KCdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB0aGUgdG9rZW4nKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdCgnc29tZXRoaW5nIGVsc2Ugb3RoZXIgdGhhbiAyMDAgd2FzIHJldHVybmVkJyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9OwogICAgICB4aHIuc2VuZCgpOwogICAgfSBlbHNlIHsKICAgICAgcmVqZWN0KCdDT1JTIG5vdCBzdXBwb3J0ZWQnKTsKICAgIH0KICB9KTsKfQoKLyoqCiogRnVuY3Rpb24gdG8gZXhjaGFuZ2UgdGhlIGNvZGUgcmVjZWl2ZWQgdG8gdGhlIGlkIFRva2VuLCBhY2Nlc3MgdG9rZW4gYW5kIGEgcmVmcmVzaCB0b2tlbgoqCiovCnZhciBleGNoYW5nZUNvZGUgPSBmdW5jdGlvbiBleGNoYW5nZUNvZGUoY29kZSkgewogIHZhciBpID0gZ29vZ2xlSW5mbzsKCiAgdmFyIFVSTCA9IGkudG9rZW5FbmRwb2ludCArICdjb2RlPScgKyBjb2RlICsgJyZjbGllbnRfaWQ9JyArIGkuY2xpZW50SUQgKyAnJmNsaWVudF9zZWNyZXQ9JyArIGkuY2xpZW50U2VjcmV0ICsgJyZyZWRpcmVjdF91cmk9JyArIGkucmVkaXJlY3RVUkkgKyAnJmdyYW50X3R5cGU9YXV0aG9yaXphdGlvbl9jb2RlJzsKCiAgLy9sZXQgVVJMID0gPSBpLnRva2VuRW5kcG9pbnQgKyAnY2xpZW50X2lkPScgKyBpLmNsaWVudElEICsgJyZjbGllbnRfc2VjcmV0PScgKyBpLmNsaWVudFNlY3JldCArICcmcmVmcmVzaF90b2tlbj0nICsgY29kZSArICcmZ3JhbnRfdHlwZT1yZWZyZXNoX3Rva2VuJzsKCiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgIHNlbmRIVFRQUmVxdWVzdCgnUE9TVCcsIFVSTCkudGhlbihmdW5jdGlvbiAoaW5mbykgewogICAgICByZXNvbHZlKGluZm8pOwogICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgIHJlamVjdChlcnJvcik7CiAgICB9KTsKICB9KTsKfTsKCi8qKgoqIElkZW50aXR5IFByb3ZpZGVyIFByb3h5CiovCnZhciBJZHBQcm94eSA9IHsKCiAgLyoqCiAgKiBGdW5jdGlvbiB0byB2YWxpZGF0ZSBhbiBpZGVudGl0eSBBc3NlcnRpb24gcmVjZWl2ZWQKICAqIFRPRE8gYWRkIGRldGFpbHMgb2YgdGhlIGltcGxlbWVudGF0aW9uLCBhbmQgaW1wcm92ZSB0aGUgaW1wbGVtZW50YXRpb24KICAqCiAgKiBAcGFyYW0gIHthc3NlcnRpb259ICAgIElkZW50aXR5IEFzc2VydGlvbiB0byBiZSB2YWxpZGF0ZWQKICAqIEBwYXJhbSAge29yaWdpbn0gICAgICAgT3JpZ2luIHBhcmFtZXRlciB0aGF0IGlkZW50aWZpZXMgdGhlIG9yaWdpbiBvZiB0aGUgUlRDUGVlckNvbm5lY3Rpb24KICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgUmV0dXJucyBhIHByb21pc2Ugd2l0aCB0aGUgaWRlbnRpdHkgYXNzZXJ0aW9uIHZhbGlkYXRpb24gcmVzdWx0CiAgKi8KICB2YWxpZGF0ZUFzc2VydGlvbjogZnVuY3Rpb24gdmFsaWRhdGVBc3NlcnRpb24oYXNzZXJ0aW9uLCBvcmlnaW4pIHsKICAgIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CiAgICAgIHZhciBpID0gZ29vZ2xlSW5mbzsKCiAgICAgIHZhciBkZWNvZGVkQ29udGVudCA9IGF0b2IoYXNzZXJ0aW9uKTsKICAgICAgdmFyIGNvbnRlbnQgPSBKU09OLnBhcnNlKGRlY29kZWRDb250ZW50KTsKICAgICAgc2VuZEhUVFBSZXF1ZXN0KCdHRVQnLCBpLnRva2VuSW5mbyArIGNvbnRlbnQudG9rZW5JRCkudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CgogICAgICAgIGlmIChKU09OLnN0cmluZ2lmeShyZXN1bHQpID09PSBKU09OLnN0cmluZ2lmeShjb250ZW50LnRva2VuSURKU09OKSkgewogICAgICAgICAgcmVzb2x2ZSh7IGlkZW50aXR5OiBjb250ZW50LnRva2VuSURKU09OLmVtYWlsLCBjb250ZW50czogY29udGVudC50b2tlbklESlNPTiB9KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVqZWN0KCdpbnZhbGlkJyk7CiAgICAgICAgfQogICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CgogICAgICAgIHJlamVjdChlcnIpOwogICAgICB9KTsKICAgIH0pOwogIH0sCgogIC8qKgogICogRnVuY3Rpb24gdG8gZ2VuZXJhdGUgYW4gaWRlbnRpdHkgQXNzZXJ0aW9uCiAgKiBUT0RPIGFkZCBkZXRhaWxzIG9mIHRoZSBpbXBsZW1lbnRhdGlvbiwgYW5kIGltcHJvdmUgaW1wbGVtZW50YXRpb24KICAqCiAgKiBAcGFyYW0gIHtjb250ZW50c30gVGhlIGNvbnRlbnRzIGluY2x1ZGVzIGluZm9ybWF0aW9uIGFib3V0IHRoZSBpZGVudGl0eSByZWNlaXZlZAogICogQHBhcmFtICB7b3JpZ2lufSBPcmlnaW4gcGFyYW1ldGVyIHRoYXQgaWRlbnRpZmllcyB0aGUgb3JpZ2luIG9mIHRoZSBSVENQZWVyQ29ubmVjdGlvbgogICogQHBhcmFtICB7dXNlcm5hbWVIaW50fSBvcHRpb25hbCB1c2VybmFtZUhpbnQgcGFyYW1ldGVyCiAgKiBAcmV0dXJuIHtQcm9taXNlfSByZXR1cm5zIGEgcHJvbWlzZSB3aXRoIGFuIGlkZW50aXR5IGFzc2VydGlvbgogICovCiAgZ2VuZXJhdGVBc3NlcnRpb246IGZ1bmN0aW9uIGdlbmVyYXRlQXNzZXJ0aW9uKGNvbnRlbnRzLCBvcmlnaW4sIGhpbnQpIHsKICAgIHZhciBpID0gZ29vZ2xlSW5mbzsKCiAgICAvL3N0YXJ0IHRoZSBsb2dpbiBwaGFzZQogICAgLy9UT0RPIGxhdGVyIHNob3VsZCBiZSBkZWZpbmVkIGEgYmV0dGVyIGFwcHJvYWNoCiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBpZiAoIWNvbnRlbnRzKSB7CiAgICAgICAgLyp0cnkgewogICAgICAgICAgaWYgKHdpbmRvdykgewogICAgICAgICAgICByZXNvbHZlKCd1cmwnKTsKICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIChlcnJvcikgeyovCgogICAgICAgIHZhciByZXF1ZXN0VXJsID0gaS5hdXRob3Jpc2F0aW9uRW5kcG9pbnQgKyAnc2NvcGU9JyArIGkuc2NvcGUgKyAnJmNsaWVudF9pZD0nICsgaS5jbGllbnRJRCArICcmcmVkaXJlY3RfdXJpPScgKyBpLnJlZGlyZWN0VVJJICsgJyZyZXNwb25zZV90eXBlPScgKyBpLnR5cGUgKyAnJnN0YXRlPScgKyBpLnN0YXRlICsgJyZhY2Nlc3NfdHlwZT0nICsgaS5hY2Nlc3NUeXBlOwoKICAgICAgICByZWplY3QoeyBuYW1lOiAnSWRQTG9naW5FcnJvcicsIGxvZ2luVXJsOiByZXF1ZXN0VXJsIH0pOwoKICAgICAgICAvLyAgfQogICAgICB9IGVsc2UgewogICAgICAgICAgLy8gdGhlIHJlcXVlc3QgaGF2ZSBhbHJlYWR5IGJlZW4gbWFkZSwgc28gaWRwUFJveHkgd2lsbCBleGNoYW5nZSB0aGUgdG9rZW5zIGFsb25nIHRvIHRoZSBpZHAsIHRvIG9idGFpbiB0aGUgaW5mb3JtYXRpb24gbmVjZXNzYXJ5CiAgICAgICAgICB2YXIgYWNjZXNzVG9rZW4gPSB1cmxQYXJzZXIoY29udGVudHMsICdhY2Nlc3NfdG9rZW4nKTsKICAgICAgICAgIHZhciBpZFRva2VuID0gdXJsUGFyc2VyKGNvbnRlbnRzLCAnaWRfdG9rZW4nKTsKICAgICAgICAgIHZhciBjb2RlID0gdXJsUGFyc2VyKGNvbnRlbnRzLCAnY29kZScpOwoKICAgICAgICAgIGV4Y2hhbmdlQ29kZShjb2RlKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewoKICAgICAgICAgICAgLy9vYnRhaW4gaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIKICAgICAgICAgICAgdmFyIGluZm9Ub2tlblVSTCA9IGkudXNlcmluZm8gKyB2YWx1ZS5hY2Nlc3NfdG9rZW47CiAgICAgICAgICAgIHNlbmRIVFRQUmVxdWVzdCgnR0VUJywgaW5mb1Rva2VuVVJMKS50aGVuKGZ1bmN0aW9uIChpbmZvVG9rZW4pIHsKCiAgICAgICAgICAgICAgdmFyIGlkZW50aXR5QnVuZGxlID0geyBhY2Nlc3NUb2tlbjogdmFsdWUuYWNjZXNzX3Rva2VuLCBpZFRva2VuOiB2YWx1ZS5pZF90b2tlbiwgcmVmcmVzaFRva2VuOiB2YWx1ZS5yZWZyZXNoX3Rva2VuLCB0b2tlblR5cGU6IHZhbHVlLnRva2VuX3R5cGUsIGluZm9Ub2tlbjogaW5mb1Rva2VuIH07CgogICAgICAgICAgICAgIHZhciBpZFRva2VuVVJMID0gaS50b2tlbkluZm8gKyB2YWx1ZS5pZF90b2tlbjsKCiAgICAgICAgICAgICAgLy9vYnRhaW4gaW5mb3JtYXRpb24gYWJvdXQgdGhlIHVzZXIgaWRUb2tlbgogICAgICAgICAgICAgIHNlbmRIVFRQUmVxdWVzdCgnR0VUJywgaWRUb2tlblVSTCkudGhlbihmdW5jdGlvbiAoaWRUb2tlbikgewoKICAgICAgICAgICAgICAgIGlkZW50aXR5QnVuZGxlLnRva2VuSURKU09OID0gaWRUb2tlbjsKICAgICAgICAgICAgICAgIGlkZW50aXR5QnVuZGxlLmV4cGlyZXMgPSBpZFRva2VuLmV4cDsKICAgICAgICAgICAgICAgIGlkZW50aXR5QnVuZGxlLmVtYWlsID0gaWRUb2tlbi5lbWFpbDsKCiAgICAgICAgICAgICAgICB2YXIgYXNzZXJ0aW9uID0gYnRvYShKU09OLnN0cmluZ2lmeSh7IHRva2VuSUQ6IHZhbHVlLmlkX3Rva2VuLCB0b2tlbklESlNPTjogaWRUb2tlbiB9KSk7CiAgICAgICAgICAgICAgICB2YXIgaWRwQnVuZGxlID0geyBkb21haW46ICdnb29nbGUuY29tJywgcHJvdG9jb2w6ICdPSURDJyB9OwoKICAgICAgICAgICAgICAgIC8vVE9ETyBkZWxldGUgbGF0ZXIgdGhlIGZpZWxkIGluZm9Ub2tlbiwgYW5kIGRlbGV0ZSB0aGUgbmVlZCBpbiB0aGUgZXhhbXBsZQogICAgICAgICAgICAgICAgdmFyIHJldHVyblZhbHVlID0geyBhc3NlcnRpb246IGFzc2VydGlvbiwgaWRwOiBpZHBCdW5kbGUsIGluZm86IGlkZW50aXR5QnVuZGxlLCBpbmZvVG9rZW46IGluZm9Ub2tlbiB9OwoKICAgICAgICAgICAgICAgIGlkZW50aXRpZXNbbklkZW50aXR5XSA9IHJldHVyblZhbHVlOwogICAgICAgICAgICAgICAgKytuSWRlbnRpdHk7CgogICAgICAgICAgICAgICAgcmVzb2x2ZShyZXR1cm5WYWx1ZSk7CiAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGUpIHsKCiAgICAgICAgICAgICAgICByZWplY3QoZSk7CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikgewoKICAgICAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnIpIHsKCiAgICAgICAgICAgIHJlamVjdChlcnIpOwogICAgICAgICAgfSk7CiAgICAgICAgfQogICAgfSk7CiAgfQp9OwoKLyoqCiogSWRlbnRpdHkgUHJvdmlkZXIgUHJveHkgUHJvdG9jb2wgU3R1YgoqLwoKdmFyIElkcFByb3h5UHJvdG9TdHViID0gKGZ1bmN0aW9uICgpIHsKCiAgLyoqCiAgKiBDb25zdHJ1Y3RvciBvZiB0aGUgSWRwUHJveHkgU3R1YgogICogVGhlIGNvbnN0cnVjdG9yIGFkZCBhIGxpc3RlbmVyIGluIHRoZSBtZXNzYWdlQnVzIHJlY2VpdmVkIGFuZCBzdGFydCBhIHdlYiB3b3JrZXIgd2l0aCB0aGUgaWRwUHJveHkgcmVjZWl2ZWQKICAqCiAgKiBAcGFyYW0gIHtVUkwuUnVudGltZVVSTH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgcnVudGltZVByb3RvU3R1YlVSTCBydW50aW1lUHJvdG9TdWJVUkwKICAqIEBwYXJhbSAge01lc3NhZ2UuTWVzc2FnZX0gICAgICAgICAgICAgICAgICAgICAgICAgICBidXNQb3N0TWVzc2FnZSAgICAgY29uZmlndXJhdGlvbgogICogQHBhcmFtICB7UHJvdG9TdHViRGVzY3JpcHRvci5Db25maWd1cmF0aW9uRGF0YUxpc3R9IGNvbmZpZ3VyYXRpb24gICAgICBjb25maWd1cmF0aW9uCiAgKi8KCiAgZnVuY3Rpb24gSWRwUHJveHlQcm90b1N0dWIocnVudGltZVByb3RvU3R1YlVSTCwgYnVzLCBjb25maWcpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJZHBQcm94eVByb3RvU3R1Yik7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLnJ1bnRpbWVQcm90b1N0dWJVUkwgPSBydW50aW1lUHJvdG9TdHViVVJMOwogICAgX3RoaXMubWVzc2FnZUJ1cyA9IGJ1czsKICAgIF90aGlzLmNvbmZpZyA9IGNvbmZpZzsKCiAgICBfdGhpcy5tZXNzYWdlQnVzLmFkZExpc3RlbmVyKCcqJywgZnVuY3Rpb24gKG1zZykgewogICAgICBpZiAobXNnLnRvID09PSAnZG9tYWluOi8vZ29vZ2xlLmNvbScpIHsKCiAgICAgICAgX3RoaXMucmVxdWVzdFRvSWRwKG1zZyk7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgLy8gZXhwb3J0IGRlZmF1bHQgSWRwUHJveHlQcm90b1N0dWI7CgogIC8qKgogICAqIFRvIGFjdGl2YXRlIHRoaXMgcHJvdG9jb2wgc3R1YiwgdXNpbmcgdGhlIHNhbWUgbWV0aG9kIGZvciBhbGwgcHJvdG9zdHViLgogICAqIEBwYXJhbSAge1VSTC5SdW50aW1lVVJMfSAgICAgICAgICAgICAgICAgICAgICAgICAgICBydW50aW1lUHJvdG9TdHViVVJMIHJ1bnRpbWVQcm90b1N1YlVSTAogICAqIEBwYXJhbSAge01lc3NhZ2UuTWVzc2FnZX0gICAgICAgICAgICAgICAgICAgICAgICAgICBidXNQb3N0TWVzc2FnZSAgICAgY29uZmlndXJhdGlvbgogICAqIEBwYXJhbSAge1Byb3RvU3R1YkRlc2NyaXB0b3IuQ29uZmlndXJhdGlvbkRhdGFMaXN0fSBjb25maWd1cmF0aW9uICAgICAgY29uZmlndXJhdGlvbgogICAqIEByZXR1cm4ge09iamVjdH0gT2JqZWN0IHdpdGggbmFtZSBhbmQgaW5zdGFuY2Ugb2YgUHJvdG9TdHViCiAgICovCgogIC8qKgogICogRnVuY3Rpb24gdGhhdCBzZWUgdGhlIGludGVuZGVkIG1ldGhvZCBpbiB0aGUgbWVzc2FnZSByZWNlaXZlZCBhbmQgY2FsbCB0aGUgcmVzcGVjdGl2ZSBmdW5jdGlvbgogICoKICAqIEBwYXJhbSB7bWVzc2FnZX0gIG1lc3NhZ2UgcmVjZWl2ZWQgaW4gdGhlIG1lc3NhZ2VCdXMKICAqLwoKICBfY3JlYXRlQ2xhc3MoSWRwUHJveHlQcm90b1N0dWIsIFt7CiAgICBrZXk6ICdyZXF1ZXN0VG9JZHAnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcXVlc3RUb0lkcChtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHBhcmFtcyA9IG1zZy5ib2R5LnBhcmFtczsKCiAgICAgIHN3aXRjaCAobXNnLmJvZHkubWV0aG9kKSB7CiAgICAgICAgY2FzZSAnZ2VuZXJhdGVBc3NlcnRpb24nOgogICAgICAgICAgSWRwUHJveHkuZ2VuZXJhdGVBc3NlcnRpb24ocGFyYW1zLmNvbnRlbnRzLCBwYXJhbXMub3JpZ2luLCBwYXJhbXMudXNlcm5hbWVIaW50KS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICBfdGhpcy5yZXBseU1lc3NhZ2UobXNnLCB2YWx1ZSk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgX3RoaXMucmVwbHlNZXNzYWdlKG1zZywgZXJyb3IpOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBjYXNlICd2YWxpZGF0ZUFzc2VydGlvbic6CiAgICAgICAgICBJZHBQcm94eS52YWxpZGF0ZUFzc2VydGlvbihwYXJhbXMuYXNzZXJ0aW9uLCBwYXJhbXMub3JpZ2luKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgICBfdGhpcy5yZXBseU1lc3NhZ2UobXNnLCB2YWx1ZSk7CiAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgICAgX3RoaXMucmVwbHlNZXNzYWdlKG1zZywgZXJyb3IpOwogICAgICAgICAgfSk7CiAgICAgICAgICBicmVhazsKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgYnJlYWs7CiAgICAgIH0KICAgIH0KCiAgICAvKioKICAgICogVGhpcyBmdW5jdGlvbiByZWNlaXZlcyBhIG1lc3NhZ2UgYW5kIGEgdmFsdWUuIEl0IHJlcGxpZXMgdGhlIHZhbHVlIHRvIHRoZSBzZW5kZXIgb2YgdGhlIG1lc3NhZ2UgcmVjZWl2ZWQKICAgICoKICAgICogQHBhcmFtICB7bWVzc2FnZX0gICBtZXNzYWdlIHJlY2VpdmVkCiAgICAqIEBwYXJhbSAge3ZhbHVlfSAgICAgdmFsdWUgdG8gaW5jbHVkZSBpbiB0aGUgbmV3IG1lc3NhZ2UgdG8gc2VuZAogICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZXBseU1lc3NhZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlcGx5TWVzc2FnZShtc2csIHZhbHVlKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgbWVzc2FnZSA9IHsgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgdG86IG1zZy5mcm9tLCBmcm9tOiBtc2cudG8sCiAgICAgICAgYm9keTogeyBjb2RlOiAyMDAsIHZhbHVlOiB2YWx1ZSB9IH07CgogICAgICBfdGhpcy5tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1lc3NhZ2UpOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIElkcFByb3h5UHJvdG9TdHViOwp9KSgpOwoKZnVuY3Rpb24gYWN0aXZhdGUodXJsLCBidXMsIGNvbmZpZykgewogIHJldHVybiB7CiAgICBuYW1lOiAnSWRwUHJveHlQcm90b1N0dWInLAogICAgaW5zdGFuY2U6IG5ldyBJZHBQcm94eVByb3RvU3R1Yih1cmwsIGJ1cywgY29uZmlnKQogIH07Cn0KCm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7fV19LHt9LFsxXSkoMSkKfSk7",
      "sourceCodeClassname": "IdpProxyProtoStub",
      "encoding": "base64",
      "signature": ""
    },
    "cguid": 1,
    "type": "ProtoStubs",
    "version": "0.1",
    "description": "Description of IdpProxyProtoStub",
    "objectName": "IdpProxyProtoStub",
    "configuration": {},
    "constraints": "",
    "sourcePackageURL": "/sourcePackage",
    "language": "javascript",
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  }
}
